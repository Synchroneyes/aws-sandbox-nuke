name: AWS Nuke Scheduled

on:
  schedule:
    - cron: '0 22 * * *' # Midnight Paris time (UTC+2/UTC+1), UTC is 2 hours behind Paris time in summer, 1 in winter

jobs:
  trigger-nuke:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger AWS Nuke On Demand workflow
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          curl -X POST \
            -H "Authorization: token ${GITHUB_TOKEN}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${REPO}/actions/workflows/nuke.yaml/dispatches \
            -d '{"ref":"main","inputs":{"no-dry-run":"true"}}'